<div class="row">
  <div class="col-sm-0 col-md-0 col-lg-1 col-xl-2"></div>
  <div class="col-sm-12 col-md-12 col-lg-10 col-xl-8">
    <div class="card">
      <div class="card-body p-0">
        <mat-stepper
          [linear]="true"
          #stepper
          class="p-2"
          style="background-color: #ffffff"
        >
          <form [formGroup]="formBooking">
            <mat-step label="Fill Booking Information" [stepControl]="formBooking">
              <div class="card mt-2">
                <div class="card-header">
                  <div class="row d-flex justify-content-between">
                    <h4 class="card-title col">Booking Information</h4>
                    <a
                      class="col d-flex justify-content-end"
                      routerLink="/auth/login"
                      *ngIf="!(isLogged$ | async)"
                      >Login as patient</a
                    >
                  </div>
                </div>
                <div class="card-body">
                  <div class="booking-doc-info">
                    <p-image
                      [src]="
                        doctorSelected != undefined
                          ? doctorSelected.avatarFilePath
                          : '/assets/images/user.png'
                      "
                      alt="Image"
                      width="150"
                      [preview]="true"
                      class="pe-3"
                    />
                    <div class="booking-info">
                      <h5>
                        <a [routerLink]="">{{
                          doctorSelected != undefined
                            ? "Dr. " + doctorSelected.fullName
                            : "Unknow Doctor"
                        }}</a>
                      </h5>
                      <div class="rating">
                        <i class="fas fa-star filled"></i>
                        <i class="fas fa-star filled"></i>
                        <i class="fas fa-star filled"></i>
                        <i class="fas fa-star filled"></i>
                        <i class="fas fa-star"></i>
                        <span class="d-inline-block average-rating">35</span>
                      </div>
                      <p class="text-muted mb-0">
                        <i class="fas fa-map-marker-alt"></i> Newyork, USA
                      </p>
                    </div>
                  </div>
                  <p-divider />
                  <div class="pt-2">
                    <h5>
                      Doctor&nbsp;<mat-icon
                        matTooltip="Choose specialty first then choose doctor"
                        style="font-size: 15px; padding-top: 0.5rem"
                        >help_outlined</mat-icon
                      >
                    </h5>
                    <div class="row">
                      <mat-form-field
                        appearance="outline"
                        class="col-sm-12 col-md-6 col-lg-6 col-xl-6"
                      >
                        <mat-label>Specialty</mat-label>
                        <input
                          type="text"
                          placeholder="Pick one"
                          matInput
                          formControlName="specialty"
                          [matAutocomplete]="autoSpecialty"
                          (blur)="specialtyChange()"
                          required
                          tabindex="1"
                        />
                        <mat-autocomplete #autoSpecialty="matAutocomplete">
                          @for (specialty of filteredSpecialties | async; track
                          specialty) {
                          <mat-option [value]="specialty.specialtyName">{{
                            specialty.specialtyName
                          }}</mat-option>
                          }
                        </mat-autocomplete>
                        <mat-error
                          *ngIf="
                            formBooking.controls['specialty'].getError(
                              'required'
                            )
                          "
                        >
                          Specialty is required.
                        </mat-error>
                      </mat-form-field>
                      <mat-form-field
                        appearance="outline"
                        class="col-sm-12 col-md-6 col-lg-6 col-xl-6"
                      >
                        <mat-label>Doctor</mat-label>
                        <input
                          type="text"
                          placeholder="Choose doctor"
                          matInput
                          formControlName="doctor"
                          [matAutocomplete]="autoDoctor"
                          (blur)="selectDoctor()"
                          required
                          tabindex="2"
                        />
                        <mat-autocomplete #autoDoctor="matAutocomplete">
                          @for (doctor of filteredDoctors | async; track doctor)
                          {
                          <mat-option [value]="doctor.fullName">{{
                            doctor.fullName
                          }}</mat-option>
                          }
                        </mat-autocomplete>
                        <mat-error
                          *ngIf="
                            formBooking.controls['doctor'].getError('required')
                          "
                        >
                          Doctor is required.
                        </mat-error>
                      </mat-form-field>
                    </div>
                    <h5>Patient</h5>
                    <div>
                      <div class="row">
                        <mat-form-field
                          appearance="outline"
                          class="col-sm-12 col-md-6 col-lg-6 col-xl-6 pb-1"
                        >
                          <mat-label>First Name</mat-label>
                          <input
                            matInput
                            placeholder="Ex. Justin"
                            formControlName="firstName"
                            required
                            tabindex="3"
                            [readonly]="isLogged$ | async"
                          />
                          <mat-error
                            *ngIf="
                              formBooking.controls['firstName'].getError(
                                'required'
                              )
                            "
                          >
                            First name is required.
                          </mat-error>
                          <mat-error
                            *ngIf="
                              formBooking.controls['firstName'].getError('name')
                            "
                          >
                            First name is invalid.
                          </mat-error>
                        </mat-form-field>
                        <mat-form-field
                          appearance="outline"
                          class="col-sm-12 col-md-6 col-lg-6 col-xl-6 pb-1"
                        >
                          <mat-label>Last Name</mat-label>
                          <input
                            matInput
                            placeholder="Ex. Timberlake"
                            formControlName="lastName"
                            required
                            tabindex="4"
                            [readonly]="isLogged$ | async"
                          />
                          <mat-error
                            *ngIf="
                              formBooking.controls['lastName'].getError(
                                'required'
                              )
                            "
                          >
                            Last name is required.
                          </mat-error>
                          <mat-error
                            *ngIf="
                              formBooking.controls['lastName'].getError('name')
                            "
                          >
                            Last name is invalid.
                          </mat-error>
                        </mat-form-field>
                      </div>
                      <div class="row">
                        <mat-form-field
                          appearance="outline"
                          class="col-sm-12 col-md-6 col-lg-6 col-xl-6 pb-1"
                        >
                          <mat-label>Phone</mat-label>
                          <input
                            matInput
                            placeholder="Ex. 0900101010"
                            formControlName="phone"
                            required
                            tabindex="5"
                            [readonly]="isLogged$ | async"
                          />
                          <mat-error
                            *ngIf="
                              formBooking.controls['phone'].getError('required')
                            "
                          >
                            Phone is required.
                          </mat-error>
                          <mat-error
                            *ngIf="
                              formBooking.controls['phone'].getError('digit')
                            "
                          >
                            Phone must contains numbers.
                          </mat-error>
                        </mat-form-field>
                        <mat-form-field
                          appearance="outline"
                          class="col-sm-12 col-md-6 col-lg-6 col-xl-6 pb-1"
                        >
                          <mat-label>Email</mat-label>
                          <input
                            matInput
                            placeholder="Ex. example@gmail.com"
                            formControlName="email"
                            required
                            tabindex="6"
                            [readonly]="isLogged$ | async"
                          />
                          <mat-error
                            *ngIf="
                              formBooking.controls['email'].getError('required')
                            "
                          >
                            Email is required.
                          </mat-error>
                          <mat-error
                            *ngIf="
                              formBooking.controls['email'].getError('email')
                            "
                          >
                            Email is invalid.
                          </mat-error>
                        </mat-form-field>
                      </div>
                      <mat-form-field
                        appearance="outline"
                        class="full-width pb-1"
                      >
                        <mat-label>Reason</mat-label>
                        <textarea
                          matInput
                          placeholder="Ex. Oral..."
                          formControlName="reason"
                          required
                          tabindex="7"
                        ></textarea>
                        <mat-error
                          *ngIf="
                            formBooking.controls['reason'].getError('required')
                          "
                        >
                          Reason is required.
                        </mat-error>
                      </mat-form-field>
                    </div>
                  </div>
                </div>
              </div>
              <div class="d-flex justify-content-between mx-2">
                <button mat-raised-button extended matStepperNext>
                  <mat-icon>close</mat-icon>
                  Cancel
                </button>
                <button
                  mat-flat-button
                  extended
                  matStepperNext
                  [disabled]="formBooking.invalid"
                  (click)="getAppointmentsBooked()"
                >
                  <mat-icon iconPositionEnd>chevron_right</mat-icon>
                  Next
                </button>
              </div>
            </mat-step>
          </form>
          <mat-step [stepControl]="formBookingDate">
            <ng-template matStepLabel
              ><div (click)="getAppointmentsBooked()">
                Choose Booking Date
              </div></ng-template
            >
            <div
              class="card d-flex justify-content-center align-items-center"
              *ngIf="isLoading"
              style="min-height: 70vh"
            >
              <p-progressSpinner
                styleClass="w-4rem h-4rem"
                strokeWidth="8"
                fill="var(--surface-ground)"
                animationDuration=".5s"
              />
            </div>
            <div class="card mt-2" *ngIf="!isLoading">
              <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                  <h4 class="card-title col">Booking Date</h4>
                  <p-calendar
                    [(ngModel)]="dateToday"
                    [disabled]="true"
                    class="d-flex flex-row-reverse"
                    dateFormat="dd/mm/yy"
                  />
                </div>
                <a
                  class="col d-flex justify-content-end p-0 pt-1"
                  routerLink="/auth/login"
                  *ngIf="!(isLogged$ | async)"
                  >Login as patient</a
                >
              </div>
              <p-carousel [value]="schedules" [numVisible]="1" [numScroll]="1">
                <ng-template pTemplate="item" let-schedule>
                  <!-- Schedule Header -->
                  <div class="schedule-header px-0">
                    <div class="row">
                      <div class="col-md-12">
                        <!-- Day Slot -->
                        <div class="day-slot">
                          <ul>
                            <li *ngFor="let day of schedule">
                              <span>{{ day.dayWeek }}</span>
                              <span class="slot-date">{{ day.date }}</span>
                            </li>
                          </ul>
                        </div>
                        <!-- /Day Slot -->
                      </div>
                    </div>
                  </div>
                  <!-- /Schedule Header -->
                  <!-- Schedule Content -->
                  <div class="schedule-cont px-0">
                    <div class="row">
                      <div class="col-md-12">
                        <!-- Time Slot -->
                        <h6>Morning</h6>
                        <div class="time-slot">
                          <ul class="clearfix">
                            <li *ngFor="let day of schedule">
                              <button
                                class="timing"
                                *ngFor="let slot of day.timeSlotsMorning"
                                [ngClass]="{
                                  selected: slot === timeSlotSelected,
                                  booked: slot.isBooked
                                }"
                                (click)="selectBookingDate(slot)"
                                matTooltip="Booked"
                                [matTooltipDisabled]="!slot.isBooked"
                                [disabled]="slot.isBooked"
                              >
                                <span>{{ slot.time }}</span>
                              </button>
                            </li>
                          </ul>
                        </div>
                        <!-- /Time Slot -->
                      </div>
                      <p-divider />
                      <div class="col-md-12">
                        <!-- Time Slot -->
                        <h6>Afternoon</h6>
                        <div class="time-slot">
                          <ul class="clearfix">
                            <li *ngFor="let day of schedule">
                              <button
                                class="timing"
                                *ngFor="let slot of day.timeSlotsAfternoon"
                                [ngClass]="{
                                  selected: slot === timeSlotSelected,
                                  booked: slot.isBooked === true
                                }"
                                (click)="selectBookingDate(slot)"
                                matTooltip="Booked"
                                [matTooltipDisabled]="!slot.isBooked"
                                [disabled]="slot.isBooked"
                              >
                                <span>{{ slot.time }}</span>
                              </button>
                            </li>
                          </ul>
                        </div>
                        <!-- /Time Slot -->
                      </div>
                    </div>
                  </div>
                  <!-- /Schedule Content -->
                </ng-template>
              </p-carousel>
            </div>
            <!-- /Schedule Widget -->
            <div class="d-flex justify-content-between mx-2">
              <button mat-raised-button extended matStepperPrevious>
                <mat-icon>chevron_left</mat-icon>
                Back
              </button>
              <button
                mat-flat-button
                extended
                matStepperNext
                [disabled]="formBookingDate.invalid || !timeSlotSelected"
              >
                <mat-icon iconPositionEnd>chevron_right</mat-icon>
                Next
              </button>
            </div>
          </mat-step>
          <mat-step label="Confirm and Done">
            <!-- Booking Summary -->
            <div class="card booking-card mt-2">
              <div class="card-header row">
                <h4 class="card-title col">Booking Summary</h4>
                <a
                  class="col d-flex justify-content-end"
                  routerLink="/auth/login"
                  *ngIf="!(isLogged$ | async)"
                  >Login as patient</a
                >
              </div>
              <div class="card-body">
                <!-- Booking Doctor Info -->
                <div class="booking-doc-info">
                  <p-image
                    [src]="
                      doctorSelected != undefined
                        ? doctorSelected.avatarFilePath
                        : '/assets/images/user.png'
                    "
                    alt="Image"
                    width="150"
                    [preview]="true"
                    class="pe-3"
                  />
                  <div class="booking-info">
                    <h4>
                      <a href="">{{
                        doctorSelected != undefined
                          ? "Dr. " + doctorSelected.fullName
                          : "Unknow Doctor"
                      }}</a>
                    </h4>
                    <div class="rating">
                      <i class="fas fa-star filled"></i>
                      <i class="fas fa-star filled"></i>
                      <i class="fas fa-star filled"></i>
                      <i class="fas fa-star filled"></i>
                      <i class="fas fa-star"></i>
                      <span class="d-inline-block average-rating">35</span>
                    </div>
                    <div class="clinic-details">
                      <p class="doc-location">
                        <i class="fas fa-map-marker-alt"></i> Newyork, USA
                      </p>
                    </div>
                  </div>
                </div>
                <!-- Booking Doctor Info -->
                <p-divider />
                <div class="booking-summary">
                  <div class="booking-item-wrap">
                    <ul class="booking-fee">
                      <li>
                        Specialty<span>{{
                          formBooking.get("specialty").value
                        }}</span>
                      </li>
                      <li>
                        Doctor Name<span
                          >Dr. {{ doctorSelected?.fullName }}</span
                        >
                      </li>
                      <li>
                        Patient Name<span>{{
                          formBooking.get("firstName")?.value +
                            " " +
                            formBooking.get("lastName")?.value
                        }}</span>
                      </li>
                      <li>
                        Phone<span>{{ formBooking.get("phone")?.value }}</span>
                      </li>
                      <li>
                        Email<span>{{ formBooking.get("email")?.value }}</span>
                      </li>
                    </ul>
                    <ul class="booking-date">
                      <li>
                        Date Booking<span>{{
                          timeSlotSelected?.date | date
                        }}</span>
                      </li>
                      <li>
                        Time Booking<span>{{ timeSlotSelected?.time }}</span>
                      </li>
                    </ul>
                  </div>
                </div>
                <!-- /Booking Summary -->
              </div>
            </div>
            <div class="d-flex justify-content-between mx-2">
              <button mat-raised-button extended matStepperPrevious>
                <mat-icon>chevron_left</mat-icon>
                Back
              </button>
              <button
                mat-flat-button
                extended
                matStepperNext
                (click)="submitAppointment()"
              >
                <mat-icon iconPositionEnd>check</mat-icon>
                Done
              </button>
            </div>
          </mat-step>
        </mat-stepper>
      </div>
    </div>
  </div>
  <div class="col-sm-0 col-md-0 col-lg-1 col-xl-2"></div>
</div>
